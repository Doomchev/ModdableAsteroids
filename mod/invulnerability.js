import Mod from "./mod.js"
import {apsk} from "../src/system.js"
import {project, val} from "../src/project.js"
import {addTranslations} from "../src/tree.js"

let instance

export default class Invulnerability extends Mod {
    constructor(blinkingSpeed) {
        super()
        this._time = 0
        this.blinkingSpeed = blinkingSpeed
        instance = this
    }

    init() {
        addTranslations({
            Invulnerability: "Неуязвимость",
            blinkingSpeed: "скоростьМигания",
        })
    }

    update() {
        if(!val.invulnerable) return
        if(this._time <= 0) {
            val.shipLayer.visible = true
            val.invulnerable = false
            return
        }
        val.shipLayer.visible = ((this._time / this.blinkingSpeed) % 2) > 1
        this._time -= apsk
    }
}

export function makeInvulnerable(time) {
    instance.time = time
    val.invulnerable = true
}